---
layout:     post
title:      Cyber-Gym 4.0 CTF Writeup
date:       2020-01-20
summary:    Detailed writeup of Internal CTF 
categories: CTF Writeup
tags: [CTF Write-up, Cyber-Gym]
---

<p align="center">
  <img src="/images/cybergym2/logo.png">
</p>

Hello Everyone 

i am back with a another CTF blog , this time some of my collegues created the challenges and hosted the CTF internally,

<p align="center">The CTF challenge is based on <strong>Harry Potter</strong> theme </p>

<p align="center">
  <img src="https://media.giphy.com/media/mz1kJeDVueKC4/giphy.gif">
</p>

The CTF format was in jeopardy. which has all type of challenges such as **Web, Mobile, Network , OSINT , Cloud, Misc, Programming**.

Rules for the CTF are quite simple. **No automated scripts allowed** which creates heavy traffic.

<p align="center">
  <img src="https://media.giphy.com/media/2kRm4LlDGGQlIpzkNk/giphy.gif">
</p>

Note : “The more you solve the points of the challenges get decrease due to the dynamic pointing system”

<p align="center">
  <strong>Android Challenges</strong>
</p>

Challenge Name : **Ronproject**

**Step 1 :** Download the APK and install into any Android Device or Emulator to check the Application UI and Functionality.

Note : Installation steps as shown below

<p align="center">
  <img src="/images/cybergym4/android1.png">
</p>

<p align="center">
  <img src="/images/cybergym4/android-2.png">
</p>

**Step 2 :**  By checking the capture image option on the Android Application , found that it scans for QR code as shown in the image below .

<p align="center">
  <img src="/images/cybergym4/android3.png">
</p>

**Step 3 :** After that i started looking for images on all the directory that is present in the application and found a intresting directory as shown below.

<p align="center">
  <img src="/images/cybergym4/android7.png">
</p>

**Step 4 :** Opening the code image shows it is broken.

<p align="center">
  <img src="/images/cybergym4/android8.png">
</p>

**Step 5 :** Then checking the format found it is **PNG** and tried to fix the corrupted magic number of the Image using the following command

```bash
hexeditor code.png
```

<p align="center">
  <img src="/images/cybergym4/android9.png">
</p>

**Magic Number of PNG** - 89 50 4E 47

<p align="center">
  <img src="/images/cybergym4/android10.png">
</p>

**Step 6 :** Open the image now , you will see the `QR Code`

<p align="center">
  <img src="/images/cybergym4/android11.png">
</p>

**Step 7 :** Scan the `QR Code`and you will get some **Secret Key** __Y0usc@nn3dth3k3y__ , but the real twist is this is not the flag !!!

<p align="center">
  <img src="/images/cybergym4/android12.png">
</p>

**Step 8 :** Went back to the Android Application and click on **WingaduimLeviosa** and we got this below error message.

<p align="center">
  <img src="/images/cybergym4/android13.png">
</p>

Note : From the above error message found that this application has some strings that are Encrypted 

**Step 9 :** Now Let's start the Static Analysis using **Apktool** using the following command

```bash
apktool d Ronproject.apk
```

<p align="center">
  <img src="/images/cybergym4/android4.png">
</p>

**Step 10 :** After that move into the **Ronproject** directory and check the **AndroidManifest.xml** file , found that it is a `Flutter Application` .

<p align="center">
  <img src="/images/cybergym4/android5.png">
</p>

**Step 11 :** Did a quick Google Search "How to decompile Flutter apk** and endup with this Link <https://stackoverflow.com/questions/53666487/flutter-debug-apk-decompile-to-get-source-code>

<p align="center">
  <img src="/images/cybergym4/android6.png">
</p>

**Step 12 :** So after going through the stackoverflow , understood that in each and every flutter application there will be `kernel_blob.bin` file which has the decompiled code of the application.

```bash
strings kernel_blob.bin > extracted_code.dart
```

<p align="center">
  <img src="/images/cybergym4/android14.png">
</p>

**Step 13 :** Open the extracted code file with any Text Editor as shown below and search for the keywords such as **Hermione** which was mentioned in the Android Application screen

<p align="center">
  <img src="/images/cybergym4/android15.png">
</p>

**Step 14 :** Now decrypt the encrypted text that we got from the extracted code and we get the flag.

`nTLxYPo5EESJTmMi/HgZ7Ip8pPGKYcEUxXMFX7I5lRQ=`

**Step 15 :** After google came across this website for Decrpyting **AES-ECB-MODE** <https://8gwifi.org/CipherFunctions.jsp> .

<p align="center">
  <img src="/images/cybergym4/android16.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{R0n_S0uld_l3arn_Hybrid}
</p>

<p align="center">
  <strong>OSINT Challenges</strong>
</p>

Challenge Name : **Cybergym Email Server**

<p align="center">
  <img src="/images/cybergym4/osint1.png">
</p>

**Step 1 :** Let’s check the spam box , from where received the credentials.

<p align="center">
  <img src="/images/cybergym4/osint2.png">
</p>

**Step 2 :** Right click and choose the show original option.

<p align="center">
  <img src="/images/cybergym4/osint3.png">
</p>

**Step 3 :** After analyzing the original message , I found there is a keyword cygym in the message.

<p align="center">
  <img src="/images/cybergym4/osint4.png">
</p>

**Step 4 :** After that we started checked the dmarc record of the main domain lucideus.in using DMARC check tool.

<p align="center">
  <img src="/images/cybergym4/osint5.png">
</p>

**Step 5 :** That's how we found the second part of the flag. 

<p align="center">
  <strong>Flag</strong>: cygym{L3ts_pr3v3nt__phishing}
</p>

<p align="center">
  <strong>Web Challenges</strong>
</p>

Challenge Name : **Norris**

<p align="center">
  <img src="/images/cybergym4/web1.png">
</p>

**Step 1 :** Open the first challenge URL <http://norris.cybergym.lucideus.in/>

<p align="center">
  <img src="/images/cybergym4/web2.png">
</p>

**Step 2 :** From the image , I was able to observe that there is a cat in it and there is a character in Harry Potter Movie called **Norris** .so started checking on the next challenge URL.

<p align="center">
  <img src="/images/cybergym4/web3.png">
</p>

**Step 3 :** The page is not working , but there is a port number 8009 in the second challenge URL , so i started searching on google with the keyword “cat 8009”.

<p align="center">
  <img src="/images/cybergym4/web4.png">
</p>

**Step 4 :** After this I started searching for an exploit POC through googling endup with this medium article [Ghostcat vulnerability | CVE-2020–1938 | AJP LFI | Apache Tomcat Server vulnerability](https://medium.com/@prem2/ghostcat-vulnerability-cve-2020-1938-ajp-lfi-apache-tomcat-server-vulnerability-9f57330e3eb1)
 
**Step 5 :** Using this Exploit from github [ZhengHaoCHeng/CNVD-2020-10487: CVE-2020-1938 / CNVD-2020-1048 Detection Tools](https://github.com/ZhengHaoCHeng/CNVD-2020-10487) , i was able to get the flag with the following command.

<p align="center">
  <img src="/images/cybergym4/web5.png">
</p>

<p align="center">
  <strong>Flag</strong>: cygym{Norris_a_Maine_Coon_cat}
</p>
